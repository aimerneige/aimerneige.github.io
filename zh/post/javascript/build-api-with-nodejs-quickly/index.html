<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>使用 nodejs 快速为 Android 程序构建 API | Aimer&#39;s Blog</title>
<meta name="keywords" content="nodejs, javascript, api, mysql">
<meta name="description" content="使用 nodejs 开发简单后端">
<meta name="author" content="Aimer Neige">
<link rel="canonical" href="https://aimerneige.com/zh/post/javascript/build-api-with-nodejs-quickly/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.1a3bc216084c4d25d9d2ad6194a81a9af705e37ffb312368d9619e5c97ac96a9.css" integrity="sha256-GjvCFghMTSXZ0q1hlKgamvcF43/7MSNo2WGeXJeslqk=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://aimerneige.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://aimerneige.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://aimerneige.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://aimerneige.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://aimerneige.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://aimerneige.com/zh/post/javascript/build-api-with-nodejs-quickly/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5QJPQTJ618"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-5QJPQTJ618', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="使用 nodejs 快速为 Android 程序构建 API" />
<meta property="og:description" content="使用 nodejs 开发简单后端" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://aimerneige.com/zh/post/javascript/build-api-with-nodejs-quickly/" />
<meta property="og:image" content="https://aimerneige.com/images/nodejs.png" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-01-30T20:17:30+08:00" />
<meta property="article:modified_time" content="2021-01-30T20:17:30+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://aimerneige.com/images/nodejs.png" />
<meta name="twitter:title" content="使用 nodejs 快速为 Android 程序构建 API"/>
<meta name="twitter:description" content="使用 nodejs 开发简单后端"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "文章 📝",
      "item": "https://aimerneige.com/zh/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "使用 nodejs 快速为 Android 程序构建 API",
      "item": "https://aimerneige.com/zh/post/javascript/build-api-with-nodejs-quickly/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "使用 nodejs 快速为 Android 程序构建 API",
  "name": "使用 nodejs 快速为 Android 程序构建 API",
  "description": "使用 nodejs 开发简单后端",
  "keywords": [
    "nodejs", "javascript", "api", "mysql"
  ],
  "articleBody": "前言 之前在学习安卓的时候，很想要给自己的软件增加一个云服务功能，但是苦于没有学过后端，于是开始在互联网上查找资料。但是遗憾的是，后端是一个很大的范围，我查找了很多后端的资料也几乎都是在讲解如何写网页，并没有专门用来给安卓写后端的教程，在广泛地学习了大量后端内容后，成功的为自己的程序开发了一个简单的 API。希望这篇文章能够帮到那些没有系统地学习过后端，但是却想要快速开发一款能用的 API 的安卓开发者。\n前期准备  你要了解互联网通讯原理 你要会一些基础的 JavaScript 你要有一台服务器 你会数据库操作 最好有一个域名（非必须） 掌握基础的终端操作  环境配置 本文章中后端开发使用的开发语言为 JavaScript 配合 nodejs。数据库采用常用的 mysql。\n 注： nodejs 开发常用的数据库是 mongodb，但是由于 mysql 比较常用这里就用 mysql 了，当然其他数据库也是可以的，你可以查找一下 nodejs 如何链接这些数据库，并将本文中 mysql 操作的部分替换掉就可以了。\n 本地测试客户端安装 你需要在自己用来开发的电脑上安装配置如下环境：\n nodejs npm  安装 nodejs Linux 下直接使用包管理安装即可。如果包管理安装的 node 很旧，可以自行谷歌一下安装方法，这里不再赘述。\n以 Ubuntu 为例，直接在终端执行如下指令：\nsudo apt install nodejs 安装完成后使用 node -v 查看 node 版本来确认安装是否成功。\n如果是 windows 用户就更加简单了，直接在 nodejs 官网 下载安装包运行即可。推荐使用长周期稳定版本。如果你想体验新特性，也可以考虑使用最新的版本。\n安装 npm 通常情况下，安装 nodejs 时会附带安装 npm，你可以直接使用 npm -v 来查看当前系统安装的 npm 版本来检测安装情况。\n如果没有安装，以 Ubuntu 系统为例，可以在终端执行下面的指令：\nsudo apt install npm windows 用户在执行完 node 的安装程序后 npm  会自动安装完成。\n服务器安装 你需要在服务器上安装配置如下环境：\n nodejs npm mysql nginx  安装 nodejs 与 npm 其中 nodejs 和 npm 的安装同客户端完全相同，这里不再赘述。\n安装 mysql mysql 可以一并安装在运行 node 项目的服务器上，也可以使用独立的数据库提供服务器。\n本文章主要讨论如何构建 API ，这里不再赘述如何安装配置 mysql。可以查看我的其他文章。\n安装 nginx nginx 用于将服务反向代理到 80 端口，以 Ubuntu 系统为例，直接在终端执行如下指令：\nsudo apt install nginx Windows 用户自行查阅相关资料。不会吧，不会吧，不会有人服务器用 windows 吧？？项目构建 使用模版 为了方便快速构建一个项目，我写了一个模版，你可以在 GitHub 上找到它。\n使用这个模版快速构建一个新的仓库，将它 clone 到本地，并进行下面的修改：\n 修改 package.json 修改 LICENSE 修改 README 在 src/config 下新建 db.js 写入数据库服务器的配置。  安装依赖 在项目路径下启动终端，执行如下指令：\nnpm i 这个指令是 npm install 的缩写，npm 会安装需要的依赖，本模版项目只依赖了俩个包：\n express mysql  依赖安装完成后，你会在项目路径下看到 node_modules 这个文件夹，它已经被写在 .gitignore 中，这个文件夹下是项目所需要的依赖，即使你意外地删掉了这个文件夹，再次执行 npm i 就可以将这些文件下载回来，所以你不应该在意这个文件夹中有什么内容，npm 会帮我们处理它。\n启动项目 使用 cd 命令切换到 src 目录下，执行下面的指令：\nnode app.js 之后你会在终端看到如下输出：\nServer start in development mode on http://localhost:4000; press Ctrl + C to terminated. 打开你的浏览器访问 http://localhost:4000/\n如果你看到下面的内容，说明项目成功启动了：\n{ \"status\": 200, \"info\": \"If you see this, the server deploy success!\" } 如果你在服务器启动项目，假设你的服务器 ip 为 43.192.82.215 并且配置了域名 api.aimerneige.com ，你可以通过在浏览器内访问下面的地址测试服务器：\n http://43.192.82.215:4000/ http://api.aimerneige.com:4000/  注意：\n 在本地测试启动的服务器只能通过 本地/内网 访问 在有公网 ip 的服务器上部署的服务可以在 任意浏览器内 打开  如果你在服务器测试，请注意以这样的方式运行仅能用来测试，不可以用作生产环境，后文会介绍如何在服务器部署项目。\n程序入口 项目可以启动后，说明环境配置无误，接下来可以开始写代码了。\n我们简单看一下程序的入口 app.js\n本项目依赖 express 构建，首先导入 express 的模块：\n// require const express = require(\"express\"); 接下来导入路由目录下的路由模块：\n// user require const indexRouter = require(\"./routes/index\"); 创建 express 对象：\n// express app var app = express(); 设置监听端口：\n// set port app.set(\"port\", process.env.PORT || 4000); 添加可以支持 json 解析的中间件：\n// json parse app.use(express.json()); app.use(express.urlencoded({ extended: false })); 添加路由中间件：\n// routes app.use(\"/\", indexRouter); 路由匹配失败后返回 404 错误：\n// catch 404 and forward to error handler app.use(function (req, res, next) {  var err = new Error(\"Not Found\");  err.status = 404;  next(err); }); 处理错误信息：\n// error handler app.use(function (err, req, res, next) {  res.type(\"application/json\");  res.status(err.status || 500);  res.send({  status: err.status || 500,  message: err.message,  }); }); 检测当前模块是否被直接执行，如果是则启动服务器，否者导出模块：\n// check if run app.js directly if (require.main === module) {  app.listen(app.get(\"port\"), function () {  console.log(  \"Server start in \" +  app.get(\"env\") +  \" mode on http://localhost:\" +  app.get(\"port\") +  \"; press Ctrl + C to terminated.\"  );  }); } else {  module.exports = app; } 其他的代码可以暂时不去理会，最重要的是路由这一部分：\n// 导入路由模块 const indexRouter = require(\"./routes/index\"); // 添加路由中间件 app.use(\"/\", indexRouter); 在编写 api 时，只需要在 /src/routes 目录下新建路由模块，并在 app.js 下引用即可。\n添加路由 接下来我们看一下默认的路由模块 index.js ：\n导入 express 模块：\nconst express = require(\"express\"); const router = express.Router(); 配置路由规则：\nrouter.get(\"/\", function (req, res, next) {  res.type(\"application/json\");  res.status(200);  res.send({  status: 200,  info: \"If you see this, the server deploy success!\",  }); }); 导出模块：\nmodule.exports = router; 其中重点即配置路由规则这一部分。\n我相信这几行代码还是很易懂的，相对地，如果我们想要使用 post 方法，访问路径为 /about 需要这样写：\nrouter.post(\"/about\", fuction(){ /* function */ } ); 设置好请求方法和请求路径后，回调函数用来向客户端返回数据。\n设置返回数据类型，这里使用 json 进行数据传输：\nres.type(\"application/json\"); 设置返回状态码：\nres.status(200); 返回指定数据：\nres.send(return_data); 由于开发语言为 js ，而且本项目添加了解析 json 的中间件，如果想要返回 json，不需像其他语言那样要将对象解析为 json 字符串，直接返回一个对象即可，客户端会成功接收到正确的 json 字符串。\n// 服务器返回的对象 {  status: 200,  info: \"If you see this, the server deploy success!\", } // 客户端拿到的字符串 { \"status\": 200, \"info\": \"If you see this, the server deploy success!\" } 书写好路由模块后在 app.js 中引用即可：\n// 导入模块 const indexRouter = require(\"./routes/index\");  // ... 中间的其他代码  // 在 app 中应用路由模块 app.use(\"/\", indexRouter); 要注意模块导入的位置，不能乱放。和模版保持一致即可。\n添加更多的路由信息 就像上面的例子中所写的，我们可以继续添加新的路由模块，也可以在同一个路由模块下添加更多的访问路径。\n src/app.js  // ...  const indexRouter = require(\"./routes/index\"); const userRouter = require(\"./routes/user\");  // ...  app.use(\"/\", indexRouter); app.use(\"/user\", userRouter);  src/routes/index.js  // ...  // 访问路径 / router.get(\"/\", fuction(){ /* function */ } );  // 访问路径 /about router.get(\"/about\", function() { /* function */ });  // ...  src/routes/user.js  // ...  // 访问路径 /user/cat router.get(\"/cat\", fuction(){ /* function */ } );  // 访问路径 /user/edit router.post(\"/edit\", fuction(){ /* function */ } );  // 访问路径 /user/new router.psot(\"/new\", fuction(){ /* function */ } );  // ... 获取客户端数据 获取请求参数信息 req.query 对象是由客户端请求参数构成的，在回调函数内，可以直接调用它来获取客户端请求参数，如果客户端传递了参数，我们就可以拿到对应的数据，否者我们只能得到 undefined。由此可以通过判空来确定客户端请求参数是否正确。\n例如我们的请求路径为 /data 所需请求参数为 id 和 class 可以这样写：\n 注： 对应的示例请求地址为 https://api.example.com/data?id=1930201\u0026class=302\n router.get(\"/data\", function (req, res) {  res.type(\"application/json\");  if (req.query.class === undefined || req.query.id === undefined) {  res.status(400);  // 向客户端返回错误信息，提示客户端返回正确的参数  res.send({  status: 400,  info: \"Wrong arguments!\",  });  } else {  // 向用户返回数据（通常会用客户端参数来调用数据库，为了简便这里返回一个类做简单示范）  res.status(200);  res.send({  status: 200,  info: {  class: req.query.class,  id: req.query.id,  },  });  } }); 我们可以通过判空来确定客户端请求参数是否正确，之后可以使用参数来进行其他操作，比如构建类，调取数据库等等。\n获取请求体信息 与请求参数类似，请求体信息也保存在一个类中，就是 req.body。使用方法和之前请求参数完全一致，这里只写一个示例，不多赘述。\nrouter.post(\"/new\", function (req, res) {  res.type(\"application/json\");  if (req.body.class === undefined || req.body.id === undefined) {  res.status(400);  // 向客户端返回错误信息，提示客户端返回正确的参数  res.send({  status: 400,  info: \"Wrong arguments!\",  });  } else {  var new_student = {  class: req.body.class,  id: req.body.id,  };  // 向数据库内添加新的学生  res.status(200);  res.send({  status: 200,  info: \"Student create successful!\",  });  } }); 获取更多信息 在回调函数中，req 对象中保存了所有来自客户请求的数据，前面介绍的只是比较常用的，其他内容可以查找文档。\n获取数据库信息 配置数据库信息 参考 db.js.example 创建 db.js 写入服务器的配置\nvar mysql = require(\"mysql\");  var pool = mysql.createPool({  host: \"host_ip\",  user: \"user_name\",  password: \"password\",  database: \"data\",  port: 3306, });  function query(sql, callback) {  pool.getConnection(function (err, connection) {  connection.query(sql, function (err, rows) {  callback(err, rows);  connection.release();  });  }); }  exports.query = query; 配置好数据库服务器后，就可以通过下面的方法访问数据库的数据了：\nsql_command = \"DROP DATABASE *;\"; // ⚠️ 注意修改 db.query(sql_command, function (err, result, fields) {  if (err) {  // 如果数据库指令执行出现了错误，返回错误信息  requestSQLFailedLog(sql_command, err);  res.status(400);  res.send({ status: 400, info: err });  } else {  // 如果数据库指令执行成功，返回数据  requestSQLSuccessLog(sql_command, result);  res.status(200);  res.send(result);  } }); 服务部署  待完善，咕咕咕\n  将项目上传到服务器 修改 db.js 的配置 cd src node cluster.js 如果你想要后台运行，执行 nohup node cluster.js \u0026  ",
  "wordCount" : "813",
  "inLanguage": "zh",
  "image":"https://aimerneige.com/images/nodejs.png","datePublished": "2021-01-30T20:17:30+08:00",
  "dateModified": "2021-01-30T20:17:30+08:00",
  "author":{
    "@type": "Person",
    "name": "Aimer Neige"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://aimerneige.com/zh/post/javascript/build-api-with-nodejs-quickly/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Aimer's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://aimerneige.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://aimerneige.com/zh/" accesskey="h" title="Aimer&#39;s Blog (Alt + H)">Aimer&#39;s Blog</a>
            <div class="logo-switches">
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://aimerneige.com/en/" title="English"
                            aria-label="English">English</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://aimerneige.com/zh/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
            <li>
                <a href="https://aimerneige.com/zh/post/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="https://aimerneige.com/zh/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://aimerneige.com/zh/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://aimerneige.com/zh/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://aimerneige.com/zh/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://aimerneige.com/zh/">主页</a>&nbsp;»&nbsp;<a href="https://aimerneige.com/zh/post/">文章 📝</a></div>
    <h1 class="post-title">
      使用 nodejs 快速为 Android 程序构建 API
    </h1>
    <div class="post-description">
      使用 nodejs 开发简单后端
    </div>
    <div class="post-meta"><span title='2021-01-30 20:17:30 +0800 CST'>一月 30, 2021</span>&nbsp;·&nbsp;Aimer Neige&nbsp;|&nbsp;<a href="https://github.com/aimerneige/blog/edit/master/content/post/JavaScript/build-api-with-nodejs-quickly.zh.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://aimerneige.com/images/nodejs.png" alt="nodejs logo">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%89%8d%e8%a8%80" aria-label="前言">前言</a></li>
                <li>
                    <a href="#%e5%89%8d%e6%9c%9f%e5%87%86%e5%a4%87" aria-label="前期准备">前期准备</a></li>
                <li>
                    <a href="#%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae" aria-label="环境配置">环境配置</a><ul>
                        
                <li>
                    <a href="#%e6%9c%ac%e5%9c%b0%e6%b5%8b%e8%af%95%e5%ae%a2%e6%88%b7%e7%ab%af%e5%ae%89%e8%a3%85" aria-label="本地测试客户端安装">本地测试客户端安装</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-nodejs" aria-label="安装 nodejs">安装 nodejs</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-npm" aria-label="安装 npm">安装 npm</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%ae%89%e8%a3%85" aria-label="服务器安装">服务器安装</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-nodejs-%e4%b8%8e-npm" aria-label="安装 nodejs 与 npm">安装 nodejs 与 npm</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-mysql" aria-label="安装 mysql">安装 mysql</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-nginx" aria-label="安装 nginx">安装 nginx</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e9%a1%b9%e7%9b%ae%e6%9e%84%e5%bb%ba" aria-label="项目构建">项目构建</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e6%a8%a1%e7%89%88" aria-label="使用模版">使用模版</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96" aria-label="安装依赖">安装依赖</a></li>
                <li>
                    <a href="#%e5%90%af%e5%8a%a8%e9%a1%b9%e7%9b%ae" aria-label="启动项目">启动项目</a></li>
                <li>
                    <a href="#%e7%a8%8b%e5%ba%8f%e5%85%a5%e5%8f%a3" aria-label="程序入口">程序入口</a></li>
                <li>
                    <a href="#%e6%b7%bb%e5%8a%a0%e8%b7%af%e7%94%b1" aria-label="添加路由">添加路由</a></li>
                <li>
                    <a href="#%e6%b7%bb%e5%8a%a0%e6%9b%b4%e5%a4%9a%e7%9a%84%e8%b7%af%e7%94%b1%e4%bf%a1%e6%81%af" aria-label="添加更多的路由信息">添加更多的路由信息</a></li>
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e5%ae%a2%e6%88%b7%e7%ab%af%e6%95%b0%e6%8d%ae" aria-label="获取客户端数据">获取客户端数据</a><ul>
                        
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e8%af%b7%e6%b1%82%e5%8f%82%e6%95%b0%e4%bf%a1%e6%81%af" aria-label="获取请求参数信息">获取请求参数信息</a></li>
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e8%af%b7%e6%b1%82%e4%bd%93%e4%bf%a1%e6%81%af" aria-label="获取请求体信息">获取请求体信息</a></li>
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e6%9b%b4%e5%a4%9a%e4%bf%a1%e6%81%af" aria-label="获取更多信息">获取更多信息</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e6%95%b0%e6%8d%ae%e5%ba%93%e4%bf%a1%e6%81%af" aria-label="获取数据库信息">获取数据库信息</a><ul>
                        
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae%e6%95%b0%e6%8d%ae%e5%ba%93%e4%bf%a1%e6%81%af" aria-label="配置数据库信息">配置数据库信息</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%9c%8d%e5%8a%a1%e9%83%a8%e7%bd%b2" aria-label="服务部署">服务部署</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="前言">前言<a hidden class="anchor" aria-hidden="true" href="#前言">#</a></h2>
<p>之前在学习安卓的时候，很想要给自己的软件增加一个云服务功能，但是苦于没有学过后端，于是开始在互联网上查找资料。但是遗憾的是，后端是一个很大的范围，我查找了很多后端的资料也几乎都是在讲解如何写网页，并没有专门用来给安卓写后端的教程，在广泛地学习了大量后端内容后，成功的为自己的程序开发了一个简单的 API。希望这篇文章能够帮到那些没有系统地学习过后端，但是却想要快速开发一款能用的 API 的安卓开发者。</p>
<h2 id="前期准备">前期准备<a hidden class="anchor" aria-hidden="true" href="#前期准备">#</a></h2>
<ol>
<li>你要了解互联网通讯原理</li>
<li>你要会一些基础的 <code>JavaScript</code></li>
<li>你要有一台服务器</li>
<li>你会数据库操作</li>
<li>最好有一个域名（非必须）</li>
<li>掌握基础的终端操作</li>
</ol>
<h2 id="环境配置">环境配置<a hidden class="anchor" aria-hidden="true" href="#环境配置">#</a></h2>
<p>本文章中后端开发使用的开发语言为 <code>JavaScript</code> 配合 <code>nodejs</code>。数据库采用常用的 <code>mysql</code>。</p>
<blockquote>
<p>注： <code>nodejs</code> 开发常用的数据库是 <code>mongodb</code>，但是由于 <code>mysql</code> 比较常用这里就用 <code>mysql</code> 了，当然其他数据库也是可以的，你可以查找一下 <code>nodejs</code> 如何链接这些数据库，并将本文中 <code>mysql</code> 操作的部分替换掉就可以了。</p>
</blockquote>
<h3 id="本地测试客户端安装">本地测试客户端安装<a hidden class="anchor" aria-hidden="true" href="#本地测试客户端安装">#</a></h3>
<p>你需要在自己用来开发的电脑上安装配置如下环境：</p>
<ul>
<li><strong>nodejs</strong></li>
<li><strong>npm</strong></li>
</ul>
<h4 id="安装-nodejs">安装 nodejs<a hidden class="anchor" aria-hidden="true" href="#安装-nodejs">#</a></h4>
<p>Linux 下直接使用包管理安装即可。如果包管理安装的 node 很旧，可以自行谷歌一下安装方法，这里不再赘述。</p>
<p>以 Ubuntu 为例，直接在终端执行如下指令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install nodejs
</span></span></code></pre></div><p>安装完成后使用 <code>node -v</code> 查看 node 版本来确认安装是否成功。</p>
<p>如果是 windows 用户就更加简单了，直接在 <a href="https://nodejs.org/">nodejs 官网</a> 下载安装包运行即可。推荐使用长周期稳定版本。如果你想体验新特性，也可以考虑使用最新的版本。</p>
<h4 id="安装-npm">安装 npm<a hidden class="anchor" aria-hidden="true" href="#安装-npm">#</a></h4>
<p>通常情况下，安装 <code>nodejs</code> 时会附带安装 <code>npm</code>，你可以直接使用 <code>npm -v</code> 来查看当前系统安装的 <code>npm</code> 版本来检测安装情况。</p>
<p>如果没有安装，以 <code>Ubuntu</code> 系统为例，可以在终端执行下面的指令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install npm
</span></span></code></pre></div><p><code>windows</code> 用户在执行完 <code>node</code> 的安装程序后 <code>npm </code> 会自动安装完成。</p>
<h3 id="服务器安装">服务器安装<a hidden class="anchor" aria-hidden="true" href="#服务器安装">#</a></h3>
<p>你需要在服务器上安装配置如下环境：</p>
<ul>
<li><strong>nodejs</strong></li>
<li><strong>npm</strong></li>
<li><strong>mysql</strong></li>
<li><strong>nginx</strong></li>
</ul>
<h4 id="安装-nodejs-与-npm">安装 nodejs 与 npm<a hidden class="anchor" aria-hidden="true" href="#安装-nodejs-与-npm">#</a></h4>
<p>其中 <code>nodejs</code> 和 <code>npm</code> 的安装同客户端完全相同，这里不再赘述。</p>
<h4 id="安装-mysql">安装 mysql<a hidden class="anchor" aria-hidden="true" href="#安装-mysql">#</a></h4>
<p><code>mysql</code> 可以一并安装在运行 <code>node</code> 项目的服务器上，也可以使用独立的数据库提供服务器。</p>
<p>本文章主要讨论如何构建 <code>API</code> ，这里不再赘述如何安装配置 <code>mysql</code>。可以查看我的其他文章。</p>
<h4 id="安装-nginx">安装 nginx<a hidden class="anchor" aria-hidden="true" href="#安装-nginx">#</a></h4>
<p>nginx 用于将服务反向代理到 80 端口，以 <code>Ubuntu</code> 系统为例，直接在终端执行如下指令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install nginx
</span></span></code></pre></div><p>Windows 用户自行查阅相关资料。<!-- raw HTML omitted --><del>不会吧，不会吧，不会有人服务器用 windows 吧？？</del><!-- raw HTML omitted --></p>
<h2 id="项目构建">项目构建<a hidden class="anchor" aria-hidden="true" href="#项目构建">#</a></h2>
<h3 id="使用模版">使用模版<a hidden class="anchor" aria-hidden="true" href="#使用模版">#</a></h3>
<p>为了方便快速构建一个项目，我写了一个模版，你可以在 <a href="https://github.com/aimerneige/node_json_api_template">GitHub</a> 上找到它。</p>
<p>使用这个模版快速构建一个新的仓库，将它 clone 到本地，并进行下面的修改：</p>
<ol>
<li>修改 package.json</li>
<li>修改 LICENSE</li>
<li>修改 README</li>
<li>在 <code>src/config</code> 下新建 <code>db.js</code> 写入数据库服务器的配置。</li>
</ol>
<h3 id="安装依赖">安装依赖<a hidden class="anchor" aria-hidden="true" href="#安装依赖">#</a></h3>
<p>在项目路径下启动终端，执行如下指令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm i
</span></span></code></pre></div><p>这个指令是 <code>npm install</code> 的缩写，<code>npm</code> 会安装需要的依赖，本模版项目只依赖了俩个包：</p>
<ol>
<li>express</li>
<li>mysql</li>
</ol>
<p>依赖安装完成后，你会在项目路径下看到 <code>node_modules</code> 这个文件夹，它已经被写在 <code>.gitignore</code> 中，这个文件夹下是项目所需要的依赖，即使你意外地删掉了这个文件夹，再次执行 <code>npm i</code> 就可以将这些文件下载回来，所以你不应该在意这个文件夹中有什么内容，<code>npm</code> 会帮我们处理它。</p>
<h3 id="启动项目">启动项目<a hidden class="anchor" aria-hidden="true" href="#启动项目">#</a></h3>
<p>使用 <code>cd</code> 命令切换到 <code>src</code> 目录下，执行下面的指令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>node app.js
</span></span></code></pre></div><p>之后你会在终端看到如下输出：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Server start in development mode on http://localhost:4000; press Ctrl + C to terminated.
</span></span></code></pre></div><p>打开你的浏览器访问 <a href="http://localhost:4000/">http://localhost:4000/</a></p>
<p>如果你看到下面的内容，说明项目成功启动了：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{ <span style="color:#f92672">&#34;status&#34;</span>: <span style="color:#ae81ff">200</span>, <span style="color:#f92672">&#34;info&#34;</span>: <span style="color:#e6db74">&#34;If you see this, the server deploy success!&#34;</span> }
</span></span></code></pre></div><p>如果你在服务器启动项目，假设你的服务器 ip 为 <code>43.192.82.215</code> 并且配置了域名 <code>api.aimerneige.com</code> ，你可以通过在浏览器内访问下面的地址测试服务器：</p>
<ul>
<li><a href="http://43.192.82.215:4000/">http://43.192.82.215:4000/</a></li>
<li><a href="http://api.aimerneige.com:4000/">http://api.aimerneige.com:4000/</a></li>
</ul>
<p>注意：</p>
<ul>
<li>在本地测试启动的服务器只能通过 <strong>本地/内网</strong> 访问</li>
<li>在有公网 ip 的服务器上部署的服务可以在 <strong>任意浏览器内</strong> 打开</li>
</ul>
<p>如果你在服务器测试，请注意以这样的方式运行仅能用来测试，不可以用作生产环境，后文会介绍如何在服务器部署项目。</p>
<h3 id="程序入口">程序入口<a hidden class="anchor" aria-hidden="true" href="#程序入口">#</a></h3>
<p>项目可以启动后，说明环境配置无误，接下来可以开始写代码了。</p>
<p>我们简单看一下程序的入口 <code>app.js</code></p>
<p>本项目依赖 express 构建，首先导入 express 的模块：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// require
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;express&#34;</span>);
</span></span></code></pre></div><p>接下来导入路由目录下的路由模块：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// user require
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">indexRouter</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;./routes/index&#34;</span>);
</span></span></code></pre></div><p>创建 express 对象：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// express app
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>();
</span></span></code></pre></div><p>设置监听端口：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// set port
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#34;port&#34;</span>, <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">PORT</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">4000</span>);
</span></span></code></pre></div><p>添加可以支持 json 解析的中间件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// json parse
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">express</span>.<span style="color:#a6e22e">json</span>());
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">express</span>.<span style="color:#a6e22e">urlencoded</span>({ <span style="color:#a6e22e">extended</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> }));
</span></span></code></pre></div><p>添加路由中间件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// routes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">indexRouter</span>);
</span></span></code></pre></div><p>路由匹配失败后返回 404 错误：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// catch 404 and forward to error handler
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Not Found&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">404</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">next</span>(<span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>处理错误信息：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// error handler
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">type</span>(<span style="color:#e6db74">&#34;application/json&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">500</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">500</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">message</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>检测当前模块是否被直接执行，如果是则启动服务器，否者导出模块：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// check if run app.js directly
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">require</span>.<span style="color:#a6e22e">main</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">module</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;port&#34;</span>), <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;Server start in &#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;env&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34; mode on http://localhost:&#34;</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;port&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;; press Ctrl + C to terminated.&#34;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">app</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>其他的代码可以暂时不去理会，最重要的是路由这一部分：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// 导入路由模块
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">indexRouter</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;./routes/index&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 添加路由中间件
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">indexRouter</span>);
</span></span></code></pre></div><p>在编写 api 时，只需要在 <code>/src/routes</code> 目录下新建路由模块，并在 <code>app.js</code> 下引用即可。</p>
<h3 id="添加路由">添加路由<a hidden class="anchor" aria-hidden="true" href="#添加路由">#</a></h3>
<p>接下来我们看一下默认的路由模块 <code>index.js</code> ：</p>
<p>导入 express 模块：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;express&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">router</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>.<span style="color:#a6e22e">Router</span>();
</span></span></code></pre></div><p>配置路由规则：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">type</span>(<span style="color:#e6db74">&#34;application/json&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;If you see this, the server deploy success!&#34;</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>导出模块：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">router</span>;
</span></span></code></pre></div><p>其中重点即配置路由规则这一部分。</p>
<p>我相信这几行代码还是很易懂的，相对地，如果我们想要使用 post 方法，访问路径为 <code>/about</code> 需要这样写：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;/about&#34;</span>, <span style="color:#a6e22e">fuction</span>(){ <span style="color:#75715e">/* function */</span> } );
</span></span></code></pre></div><p>设置好请求方法和请求路径后，回调函数用来向客户端返回数据。</p>
<p>设置返回数据类型，这里使用 <code>json</code> 进行数据传输：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">type</span>(<span style="color:#e6db74">&#34;application/json&#34;</span>);
</span></span></code></pre></div><p>设置返回状态码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>);
</span></span></code></pre></div><p>返回指定数据：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">return_data</span>);
</span></span></code></pre></div><p>由于开发语言为 js ，而且本项目添加了解析 json 的中间件，如果想要返回 json，不需像其他语言那样要将对象解析为 json 字符串，直接返回一个对象即可，客户端会成功接收到正确的 json 字符串。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// 服务器返回的对象
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;If you see this, the server deploy success!&#34;</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#75715e">// 客户端拿到的字符串
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>{ <span style="color:#f92672">&#34;status&#34;</span>: <span style="color:#ae81ff">200</span>, <span style="color:#f92672">&#34;info&#34;</span>: <span style="color:#e6db74">&#34;If you see this, the server deploy success!&#34;</span> }
</span></span></code></pre></div><p>书写好路由模块后在 <code>app.js</code> 中引用即可：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// 导入模块
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">indexRouter</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;./routes/index&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ... 中间的其他代码
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 在 app 中应用路由模块
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">indexRouter</span>);
</span></span></code></pre></div><p>要注意模块导入的位置，不能乱放。和模版保持一致即可。</p>
<h3 id="添加更多的路由信息">添加更多的路由信息<a hidden class="anchor" aria-hidden="true" href="#添加更多的路由信息">#</a></h3>
<p>就像上面的例子中所写的，我们可以继续添加新的路由模块，也可以在同一个路由模块下添加更多的访问路径。</p>
<ul>
<li><code>src/app.js</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">indexRouter</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;./routes/index&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">userRouter</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;./routes/user&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">indexRouter</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#34;/user&#34;</span>, <span style="color:#a6e22e">userRouter</span>);
</span></span></code></pre></div><ul>
<li><code>src/routes/index.js</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 访问路径 /
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">fuction</span>(){ <span style="color:#75715e">/* function */</span> } );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 访问路径 /about
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;/about&#34;</span>, <span style="color:#66d9ef">function</span>() { <span style="color:#75715e">/* function */</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span></code></pre></div><ul>
<li><code>src/routes/user.js</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 访问路径 /user/cat
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;/cat&#34;</span>, <span style="color:#a6e22e">fuction</span>(){ <span style="color:#75715e">/* function */</span> } );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 访问路径 /user/edit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;/edit&#34;</span>, <span style="color:#a6e22e">fuction</span>(){ <span style="color:#75715e">/* function */</span> } );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 访问路径 /user/new
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">psot</span>(<span style="color:#e6db74">&#34;/new&#34;</span>, <span style="color:#a6e22e">fuction</span>(){ <span style="color:#75715e">/* function */</span> } );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span></code></pre></div><h3 id="获取客户端数据">获取客户端数据<a hidden class="anchor" aria-hidden="true" href="#获取客户端数据">#</a></h3>
<h4 id="获取请求参数信息">获取请求参数信息<a hidden class="anchor" aria-hidden="true" href="#获取请求参数信息">#</a></h4>
<p><code>req.query</code> 对象是由客户端请求参数构成的，在回调函数内，可以直接调用它来获取客户端请求参数，如果客户端传递了参数，我们就可以拿到对应的数据，否者我们只能得到 <code>undefined</code>。由此可以通过判空来确定客户端请求参数是否正确。</p>
<p>例如我们的请求路径为 <code>/data</code> 所需请求参数为 <code>id</code> 和 <code>class</code> 可以这样写：</p>
<blockquote>
<p>注： 对应的示例请求地址为 <code>https://api.example.com/data?id=1930201&amp;class=302</code></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;/data&#34;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">type</span>(<span style="color:#e6db74">&#34;application/json&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">query</span>.<span style="color:#66d9ef">class</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">400</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 向客户端返回错误信息，提示客户端返回正确的参数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">400</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Wrong arguments!&#34;</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 向用户返回数据（通常会用客户端参数来调用数据库，为了简便这里返回一个类做简单示范）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">class</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">query</span>.<span style="color:#66d9ef">class</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>我们可以通过判空来确定客户端请求参数是否正确，之后可以使用参数来进行其他操作，比如构建类，调取数据库等等。</p>
<h4 id="获取请求体信息">获取请求体信息<a hidden class="anchor" aria-hidden="true" href="#获取请求体信息">#</a></h4>
<p>与请求参数类似，请求体信息也保存在一个类中，就是 <code>req.body</code>。使用方法和之前请求参数完全一致，这里只写一个示例，不多赘述。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;/new&#34;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">type</span>(<span style="color:#e6db74">&#34;application/json&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#66d9ef">class</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">undefined</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">400</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 向客户端返回错误信息，提示客户端返回正确的参数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">400</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Wrong arguments!&#34;</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">new_student</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">class</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#66d9ef">class</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 向数据库内添加新的学生
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>({
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Student create successful!&#34;</span>,
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h4 id="获取更多信息">获取更多信息<a hidden class="anchor" aria-hidden="true" href="#获取更多信息">#</a></h4>
<p>在回调函数中，req 对象中保存了所有来自客户请求的数据，前面介绍的只是比较常用的，其他内容可以查找文档。</p>
<h3 id="获取数据库信息">获取数据库信息<a hidden class="anchor" aria-hidden="true" href="#获取数据库信息">#</a></h3>
<h4 id="配置数据库信息">配置数据库信息<a hidden class="anchor" aria-hidden="true" href="#配置数据库信息">#</a></h4>
<p>参考 <code>db.js.example</code> 创建 <code>db.js</code> 写入服务器的配置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">mysql</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;mysql&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pool</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mysql</span>.<span style="color:#a6e22e">createPool</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">host</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;host_ip&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;user_name&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">password</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;password&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">database</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;data&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3306</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">query</span>(<span style="color:#a6e22e">sql</span>, <span style="color:#a6e22e">callback</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pool</span>.<span style="color:#a6e22e">getConnection</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">connection</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">connection</span>.<span style="color:#a6e22e">query</span>(<span style="color:#a6e22e">sql</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">rows</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">callback</span>(<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">rows</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">connection</span>.<span style="color:#a6e22e">release</span>();
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">query</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">query</span>;
</span></span></code></pre></div><p>配置好数据库服务器后，就可以通过下面的方法访问数据库的数据了：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">sql_command</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;DROP DATABASE *;&#34;</span>; <span style="color:#75715e">// ⚠️ 注意修改
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">query</span>(<span style="color:#a6e22e">sql_command</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">fields</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 如果数据库指令执行出现了错误，返回错误信息
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">requestSQLFailedLog</span>(<span style="color:#a6e22e">sql_command</span>, <span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">400</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>({ <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">400</span>, <span style="color:#a6e22e">info</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">err</span> });
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 如果数据库指令执行成功，返回数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">requestSQLSuccessLog</span>(<span style="color:#a6e22e">sql_command</span>, <span style="color:#a6e22e">result</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">result</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="服务部署">服务部署<a hidden class="anchor" aria-hidden="true" href="#服务部署">#</a></h2>
<blockquote>
<p>待完善，咕咕咕</p>
</blockquote>
<ol>
<li>将项目上传到服务器</li>
<li>修改 <code>db.js</code> 的配置</li>
<li><code>cd src</code></li>
<li><code>node cluster.js</code></li>
<li>如果你想要后台运行，执行 <code>nohup node cluster.js &amp;</code></li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://aimerneige.com/zh/tags/nodejs/">nodejs</a></li>
      <li><a href="https://aimerneige.com/zh/tags/javascript/">javascript</a></li>
      <li><a href="https://aimerneige.com/zh/tags/api/">api</a></li>
      <li><a href="https://aimerneige.com/zh/tags/mysql/">mysql</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://aimerneige.com/zh/post/others/hello-hugo/">
    <span class="title">« 上一页</span>
    <br>
    <span>Hello Hugo</span>
  </a>
  <a class="next" href="https://aimerneige.com/zh/post/tool/editorconfig/">
    <span class="title">下一页 »</span>
    <br>
    <span>利用 EditorConfig 定义代码格式，统一代码风格</span>
  </a>
</nav>

  </footer>
<div id="license">
    <p>
        This article is licensed under
        <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/" style="color: #00b5da">
            <u>CC-BY-NC-4.0</u>
        </a>
    </p>
</div>

<div id="comment">
    <script
        id="utterances"
        src="https://utteranc.es/client.js"
        repo="aimerneige/aimerneige.github.io"
        issue-term="title"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async
    ></script>
    <script>
        
        let ua = navigator.userAgent.toLocaleLowerCase();
        if (ua.match(/QQ/i) == "qq") {
            document.getElementById("utterances").remove();
        }
        if (ua.match(/MicroMessenger/i) == "micromessenger") {
            document.getElementById("utterances").remove();
        }
    </script>
</div>




</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://aimerneige.com/zh/">Aimer&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
