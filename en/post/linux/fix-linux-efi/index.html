<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Fix Linux EFI | Aimer's Blog</title>
<meta name=keywords content="efi"><meta name=description content="When you have many disks, and you install many operating system, you may faced with a problem. That is your system&rsquo;s EFI file will be stored in a different disk rather than your root disk. Also, you may accidentally delete system&rsquo;s EFI file in a different disk. Here is how you can fix it.
Warning
This article is not a step-by-step guide!
All the commands in this article are very dangerous."><meta name=author content="Aimer Neige"><link rel=canonical href=https://aimerneige.com/en/post/linux/fix-linux-efi/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://aimerneige.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://aimerneige.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://aimerneige.com/favicon-32x32.png><link rel=apple-touch-icon href=https://aimerneige.com/apple-touch-icon.png><link rel=mask-icon href=https://aimerneige.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://aimerneige.com/en/post/linux/fix-linux-efi/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://aimerneige.com/en/post/linux/fix-linux-efi/"><meta property="og:site_name" content="Aimer's Blog"><meta property="og:title" content="Fix Linux EFI"><meta property="og:description" content="When you have many disks, and you install many operating system, you may faced with a problem. That is your system‚Äôs EFI file will be stored in a different disk rather than your root disk. Also, you may accidentally delete system‚Äôs EFI file in a different disk. Here is how you can fix it.
Warning
This article is not a step-by-step guide!
All the commands in this article are very dangerous."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-12-22T22:44:57+08:00"><meta property="article:modified_time" content="2024-12-22T22:44:57+08:00"><meta property="article:tag" content="Efi"><meta name=twitter:card content="summary"><meta name=twitter:title content="Fix Linux EFI"><meta name=twitter:description content="When you have many disks, and you install many operating system, you may faced with a problem. That is your system&rsquo;s EFI file will be stored in a different disk rather than your root disk. Also, you may accidentally delete system&rsquo;s EFI file in a different disk. Here is how you can fix it.
Warning
This article is not a step-by-step guide!
All the commands in this article are very dangerous."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts üìù","item":"https://aimerneige.com/en/post/"},{"@type":"ListItem","position":2,"name":"Fix Linux EFI","item":"https://aimerneige.com/en/post/linux/fix-linux-efi/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Fix Linux EFI","name":"Fix Linux EFI","description":"When you have many disks, and you install many operating system, you may faced with a problem. That is your system\u0026rsquo;s EFI file will be stored in a different disk rather than your root disk. Also, you may accidentally delete system\u0026rsquo;s EFI file in a different disk. Here is how you can fix it.\nWarning\nThis article is not a step-by-step guide!\nAll the commands in this article are very dangerous.","keywords":["efi"],"articleBody":"When you have many disks, and you install many operating system, you may faced with a problem. That is your system‚Äôs EFI file will be stored in a different disk rather than your root disk. Also, you may accidentally delete system‚Äôs EFI file in a different disk. Here is how you can fix it.\nWarning\nThis article is not a step-by-step guide!\nAll the commands in this article are very dangerous.\nThink carefully and check your command before you press Enter.\nDo it with your own risk!\nI am not in response for your data loss.\nMigrate EFI file to same disk I assume that you have two disk: nvme0n1 and nvme1n1. Use lsblk command to know your disks.\nHere is a correct sample. Fedora are on nvme0n1 and Ubuntu on nvme1n1:\n‚ûú sudo lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS nvme0n1 259:3 0 931.5G 0 disk ‚îú‚îÄnvme0n1p1 259:4 0 512M 0 part ‚îî‚îÄnvme0n1p2 259:5 0 931G 0 part nvme1n1 259:0 0 465.8G 0 disk ‚îú‚îÄnvme1n1p1 259:1 0 512M 0 part /boot/efi ‚îî‚îÄnvme1n1p2 259:2 0 465.3G 0 part / But sometimes, your EFI file will be stored into a different disk like this:\n‚ûú sudo lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS nvme0n1 259:3 0 931.5G 0 disk ‚îú‚îÄnvme0n1p1 259:4 0 512M 0 part /boot/efi ‚îî‚îÄnvme0n1p2 259:5 0 931G 0 part nvme1n1 259:0 0 465.8G 0 disk ‚îú‚îÄnvme1n1p1 259:1 0 512M 0 part ‚îî‚îÄnvme1n1p2 259:2 0 465.3G 0 part / You EFI file is stored in /dev/nvme0n1p1, not /dev/nvme1n1p1.\nIf you want to migrate efi file from /dev/nvme0n1p1 to /dev/nvme1n1p1, it‚Äôs easy.\nThe basic concept is:\nformat disk rightly mount both part move files update /etc/fstab EFI partition should be in FAT32. Here is how you can format it:\nsudo mkfs.fat -F32 /dev/nvme1n1p1 In most cases, the install software has already format it for you. It just pick a wrong disk partition. But you can still use this command to get a clear EFI partition.\nAfter you get a right partition, mount it:\nsudo mount /dev/nvme1n1p1 /mnt/boot Then copy all the files from /boot/efi/ to /mnt/boot:\nsudo cp -r /boot/efi/* /mnt/boot After you copy the efi files, you still need to edit /etc/fstab to mount correct disk when system reboot.\nsudo vim /etc/fstab The origin config will be like this:\nUUID=9D4C-93FE /boot/efi vfat umask=0077 0 1 Use blkid to get uuid:\n‚ûú sudo blkid /dev/nvme0n1p1: UUID=\"9D4C-93FE\" BLOCK_SIZE=\"512\" TYPE=\"vfat\" PARTLABEL=\"EFI System Partition\" PARTUUID=\"c5c9cac8-7a1b-47f7-a020-7e9d3d278c75\" /dev/nvme0n1p2: UUID=\"16461f63-c03e-4dd4-a032-9ef49ee48854\" BLOCK_SIZE=\"4096\" TYPE=\"ext4\" PARTUUID=\"fb46775f-4538-4fa3-a909-7f37c5c59f1d\" /dev/nvme1n1p2: UUID=\"72d8bf22-bd3f-48e5-aeab-10604f83d254\" BLOCK_SIZE=\"4096\" TYPE=\"ext4\" PARTUUID=\"0e2c65f1-4cb3-4121-8a81-22b5bdd8f28b\" /dev/nvme1n1p1: UUID=\"134D-9AFB\" BLOCK_SIZE=\"512\" TYPE=\"vfat\" PARTLABEL=\"EFI System Partition\" PARTUUID=\"b110cd31-bd24-4566-b986-6c57a97ffe73\" ‚ûú sudo blkid /dev/nvme1n1p1 /dev/nvme1n1p1: UUID=\"134D-9AFB\" BLOCK_SIZE=\"512\" TYPE=\"vfat\" PARTLABEL=\"EFI System Partition\" PARTUUID=\"b110cd31-bd24-4566-b986-6c57a97ffe73\" The /dev/nvme0n1p1 partition will be mounted to /boot/efi. Change the UUID to /dev/nvme0n1p1. Just like this:\nUUID=134D-9AFB /boot/efi vfat umask=0077 0 1 Then the system will try to mount /dev/nvme1n1p1 into /boot/efi.\nReboot your system to check if system mount right partion:\nsudo reboot Restore EFI files with grub If you have already delete the entire disk which store your EFI files, here is how you can restore them.\nThe basic concept is:\nBoot from live cd Recreate a EFI partition Mount root partition Mount EFI partition Mount /dev, /proc, and /sys Chroot into it Run grub-install Edit /etc/fstab Umount everything Reboot your system First you need a EFI partition, use fdisk to create a partition and format it:\nsudo mkfs.fat -F32 /dev/sda1 Mount the root directory:\nsudo mount /dev/sda2 /mnt Mount the EFI partition:\nsudo mount /dev/sda1 /mnt/boot/efi Mount /dev and other necessary part:\nsudo mount --bind /dev /mnt/dev/ sudo mount --bind /proc /mnt/proc/ sudo mount --bind /sys /mnt/sys/ Chroot into your system:\nsudo chroot /mnt You can use ls to check if you mount the right partition.\nThen you can recreate EFI files with grub:\nsudo grub-install /dev/sda If this process did‚Äôt give you any error, the EFI files are restored.\nThen you need to update /etc/fstab\nsudo vim /etc/fstab Use blkid to get disk uuid and mount the correct uuid like what I say before.\nThen exit back to live cd system:\nexit Umount everything:\nsudo umount /mnt/dev sudo umount /mnt/proc sudo umount /mnt/sys sudo umount /mnt/boot/efi sudo umount /mnt Reboot your system:\nsudo reboot ","wordCount":"692","inLanguage":"en","datePublished":"2024-12-22T22:44:57+08:00","dateModified":"2024-12-22T22:44:57+08:00","author":{"@type":"Person","name":"Aimer Neige"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://aimerneige.com/en/post/linux/fix-linux-efi/"},"publisher":{"@type":"Organization","name":"Aimer's Blog","logo":{"@type":"ImageObject","url":"https://aimerneige.com/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://aimerneige.com/en/ accesskey=h title="Aimer's Blog (Alt + H)">Aimer's Blog</a><div class=logo-switches><ul class=lang-switch><li>|</li><li><a href=https://aimerneige.com/zh/ title=‰∏≠Êñá aria-label=‰∏≠Êñá>‰∏≠Êñá</a></li></ul></div></div><ul id=menu><li><a href=https://aimerneige.com/en/about/ title=About><span>About</span></a></li><li><a href=https://aimerneige.com/en/post/ title=Post><span>Post</span></a></li><li><a href=https://aimerneige.com/en/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://aimerneige.com/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://aimerneige.com/en/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://aimerneige.com/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://aimerneige.com/en/>Home</a>&nbsp;¬ª&nbsp;<a href=https://aimerneige.com/en/post/>Posts üìù</a></div><h1 class="post-title entry-hint-parent">Fix Linux EFI</h1><div class=post-meta><span title='2024-12-22 22:44:57 +0800 +0800'>December 22, 2024</span>&nbsp;¬∑&nbsp;Aimer Neige&nbsp;|&nbsp;<a href=https://github.com/aimerneige/blog/edit/master/content/post/Linux/fix-linux-efi.en.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#migrate-efi-file-to-same-disk aria-label="Migrate EFI file to same disk">Migrate EFI file to same disk</a></li><li><a href=#restore-efi-files-with-grub aria-label="Restore EFI files with grub">Restore EFI files with grub</a></li></ul></div></details></div><div class=post-content><p>When you have many disks, and you install many operating system, you may faced with a problem. That is your system&rsquo;s EFI file will be stored in a different disk rather than your root disk. Also, you may accidentally delete system&rsquo;s EFI file in a different disk. Here is how you can fix it.</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}@media(prefers-color-scheme:dark){.notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}.notice.info{--title-background-color:#a50;--content-background-color:#420}.notice.tip{--title-background-color:#363;--content-background-color:#121}.notice.warning{--title-background-color:#800;--content-background-color:#400}}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>Warning</p><p>This article is not a step-by-step guide!</p><p>All the commands in this article are very dangerous.</p><p>Think carefully and check your command before you press Enter.</p><p>Do it with your own risk!</p><p>I am not in response for your data loss.</p></div><h2 id=migrate-efi-file-to-same-disk>Migrate EFI file to same disk<a hidden class=anchor aria-hidden=true href=#migrate-efi-file-to-same-disk>#</a></h2><p>I assume that you have two disk: <code>nvme0n1</code> and <code>nvme1n1</code>. Use <code>lsblk</code> command to know your disks.</p><p>Here is a correct sample. Fedora are on <code>nvme0n1</code> and Ubuntu on <code>nvme1n1</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‚ûú sudo lsblk
</span></span><span style=display:flex><span>NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
</span></span><span style=display:flex><span>nvme0n1     259:3    <span style=color:#ae81ff>0</span> 931.5G  <span style=color:#ae81ff>0</span> disk
</span></span><span style=display:flex><span>‚îú‚îÄnvme0n1p1 259:4    <span style=color:#ae81ff>0</span>   512M  <span style=color:#ae81ff>0</span> part
</span></span><span style=display:flex><span>‚îî‚îÄnvme0n1p2 259:5    <span style=color:#ae81ff>0</span>   931G  <span style=color:#ae81ff>0</span> part
</span></span><span style=display:flex><span>nvme1n1     259:0    <span style=color:#ae81ff>0</span> 465.8G  <span style=color:#ae81ff>0</span> disk
</span></span><span style=display:flex><span>‚îú‚îÄnvme1n1p1 259:1    <span style=color:#ae81ff>0</span>   512M  <span style=color:#ae81ff>0</span> part /boot/efi
</span></span><span style=display:flex><span>‚îî‚îÄnvme1n1p2 259:2    <span style=color:#ae81ff>0</span> 465.3G  <span style=color:#ae81ff>0</span> part /
</span></span></code></pre></div><p>But sometimes, your EFI file will be stored into a different disk like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‚ûú sudo lsblk
</span></span><span style=display:flex><span>NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
</span></span><span style=display:flex><span>nvme0n1     259:3    <span style=color:#ae81ff>0</span> 931.5G  <span style=color:#ae81ff>0</span> disk
</span></span><span style=display:flex><span>‚îú‚îÄnvme0n1p1 259:4    <span style=color:#ae81ff>0</span>   512M  <span style=color:#ae81ff>0</span> part /boot/efi
</span></span><span style=display:flex><span>‚îî‚îÄnvme0n1p2 259:5    <span style=color:#ae81ff>0</span>   931G  <span style=color:#ae81ff>0</span> part
</span></span><span style=display:flex><span>nvme1n1     259:0    <span style=color:#ae81ff>0</span> 465.8G  <span style=color:#ae81ff>0</span> disk
</span></span><span style=display:flex><span>‚îú‚îÄnvme1n1p1 259:1    <span style=color:#ae81ff>0</span>   512M  <span style=color:#ae81ff>0</span> part
</span></span><span style=display:flex><span>‚îî‚îÄnvme1n1p2 259:2    <span style=color:#ae81ff>0</span> 465.3G  <span style=color:#ae81ff>0</span> part /
</span></span></code></pre></div><p>You EFI file is stored in <code>/dev/nvme0n1p1</code>, not <code>/dev/nvme1n1p1</code>.</p><p>If you want to migrate efi file from <code>/dev/nvme0n1p1</code> to <code>/dev/nvme1n1p1</code>, it&rsquo;s easy.</p><p>The basic concept is:</p><ol><li>format disk rightly</li><li>mount both part</li><li>move files</li><li>update <code>/etc/fstab</code></li></ol><p>EFI partition should be in FAT32. Here is how you can format it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkfs.fat -F32 /dev/nvme1n1p1
</span></span></code></pre></div><p>In most cases, the install software has already format it for you. It just pick a wrong disk partition. But you can still use this command to get a clear EFI partition.</p><p>After you get a right partition, mount it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mount /dev/nvme1n1p1 /mnt/boot
</span></span></code></pre></div><p>Then copy all the files from <code>/boot/efi/</code> to <code>/mnt/boot</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp -r /boot/efi/* /mnt/boot
</span></span></code></pre></div><p>After you copy the efi files, you still need to edit <code>/etc/fstab</code> to mount correct disk when system reboot.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/fstab
</span></span></code></pre></div><p>The origin config will be like this:</p><pre tabindex=0><code>UUID=9D4C-93FE  /boot/efi  vfat  umask=0077  0  1
</code></pre><p>Use <code>blkid</code> to get uuid:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>‚ûú sudo blkid
</span></span><span style=display:flex><span>/dev/nvme0n1p1: UUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;9D4C-93FE&#34;</span> BLOCK_SIZE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;512&#34;</span> TYPE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vfat&#34;</span> PARTLABEL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;EFI System Partition&#34;</span> PARTUUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;c5c9cac8-7a1b-47f7-a020-7e9d3d278c75&#34;</span>
</span></span><span style=display:flex><span>/dev/nvme0n1p2: UUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;16461f63-c03e-4dd4-a032-9ef49ee48854&#34;</span> BLOCK_SIZE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;4096&#34;</span> TYPE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ext4&#34;</span> PARTUUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;fb46775f-4538-4fa3-a909-7f37c5c59f1d&#34;</span>
</span></span><span style=display:flex><span>/dev/nvme1n1p2: UUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;72d8bf22-bd3f-48e5-aeab-10604f83d254&#34;</span> BLOCK_SIZE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;4096&#34;</span> TYPE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ext4&#34;</span> PARTUUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;0e2c65f1-4cb3-4121-8a81-22b5bdd8f28b&#34;</span>
</span></span><span style=display:flex><span>/dev/nvme1n1p1: UUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;134D-9AFB&#34;</span> BLOCK_SIZE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;512&#34;</span> TYPE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vfat&#34;</span> PARTLABEL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;EFI System Partition&#34;</span> PARTUUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;b110cd31-bd24-4566-b986-6c57a97ffe73&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>‚ûú sudo blkid /dev/nvme1n1p1
</span></span><span style=display:flex><span>/dev/nvme1n1p1: UUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;134D-9AFB&#34;</span> BLOCK_SIZE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;512&#34;</span> TYPE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;vfat&#34;</span> PARTLABEL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;EFI System Partition&#34;</span> PARTUUID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;b110cd31-bd24-4566-b986-6c57a97ffe73&#34;</span>
</span></span></code></pre></div><p>The <code>/dev/nvme0n1p1</code> partition will be mounted to <code>/boot/efi</code>. Change the UUID to <code>/dev/nvme0n1p1</code>. Just like this:</p><pre tabindex=0><code>UUID=134D-9AFB  /boot/efi  vfat  umask=0077  0  1
</code></pre><p>Then the system will try to mount <code>/dev/nvme1n1p1</code> into <code>/boot/efi</code>.</p><p>Reboot your system to check if system mount right partion:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo reboot
</span></span></code></pre></div><h2 id=restore-efi-files-with-grub>Restore EFI files with grub<a hidden class=anchor aria-hidden=true href=#restore-efi-files-with-grub>#</a></h2><p>If you have already delete the entire disk which store your EFI files, here is how you can restore them.</p><p>The basic concept is:</p><ol><li>Boot from live cd</li><li>Recreate a EFI partition</li><li>Mount root partition</li><li>Mount EFI partition</li><li>Mount /dev, /proc, and /sys</li><li>Chroot into it</li><li>Run <code>grub-install</code></li><li>Edit <code>/etc/fstab</code></li><li>Umount everything</li><li>Reboot your system</li></ol><p>First you need a EFI partition, use <code>fdisk</code> to create a partition and format it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkfs.fat -F32 /dev/sda1
</span></span></code></pre></div><p>Mount the root directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mount /dev/sda2 /mnt
</span></span></code></pre></div><p>Mount the EFI partition:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mount /dev/sda1 /mnt/boot/efi
</span></span></code></pre></div><p>Mount /dev and other necessary part:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mount --bind /dev /mnt/dev/
</span></span><span style=display:flex><span>sudo mount --bind /proc /mnt/proc/
</span></span><span style=display:flex><span>sudo mount --bind /sys /mnt/sys/
</span></span></code></pre></div><p>Chroot into your system:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo chroot /mnt
</span></span></code></pre></div><p>You can use ls to check if you mount the right partition.</p><p>Then you can recreate EFI files with grub:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo grub-install /dev/sda
</span></span></code></pre></div><p>If this process did&rsquo;t give you any error, the EFI files are restored.</p><p>Then you need to update <code>/etc/fstab</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/fstab
</span></span></code></pre></div><p>Use <code>blkid</code> to get disk uuid and mount the correct uuid like what I say before.</p><p>Then exit back to live cd system:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>exit
</span></span></code></pre></div><p>Umount everything:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo umount /mnt/dev
</span></span><span style=display:flex><span>sudo umount /mnt/proc
</span></span><span style=display:flex><span>sudo umount /mnt/sys
</span></span><span style=display:flex><span>sudo umount /mnt/boot/efi
</span></span><span style=display:flex><span>sudo umount /mnt
</span></span></code></pre></div><p>Reboot your system:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo reboot
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://aimerneige.com/en/tags/efi/>Efi</a></li></ul><nav class=paginav><a class=next href=https://aimerneige.com/en/post/linux/setup-your-own-apt-mirror/><span class=title>Next ¬ª</span><br><span>Setup Your Own Apt Mirror</span></a></nav></footer><div id=license><p>This article is licensed under
<a target=_blank rel=noopener href=http://creativecommons.org/licenses/by-nc/4.0/ style=color:#00b5da><u>CC-BY-NC-4.0</u></a></p></div><div id=comment><script id=utterances src=https://utteranc.es/client.js repo=aimerneige/aimerneige.github.io issue-term=title label=comment theme=preferred-color-scheme crossorigin=anonymous async></script><script>let ua=navigator.userAgent.toLocaleLowerCase();ua.match(/QQ/i)=="qq"&&document.getElementById("utterances").remove(),ua.match(/MicroMessenger/i)=="micromessenger"&&document.getElementById("utterances").remove()</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://aimerneige.com/en/>Aimer's Blog</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>