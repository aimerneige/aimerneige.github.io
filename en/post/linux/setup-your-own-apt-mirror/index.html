<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Setup Your Own Apt Mirror | Aimer's Blog</title>
<meta name=keywords content="apt,self-hosting"><meta name=description content="What you need a server running ubuntu enough disk space (at least 600G) good internet connection a domain name (optional) a ssl certificate (optional) Prepare your server You can buy a cloud server, or use a local machine. Here, I am using a local machine to setup a offline apt mirror which can speed up my workflow.
Install apt-mirror Just run the following command to install apt-mirror on your server:"><meta name=author content="Aimer Neige"><link rel=canonical href=https://aimerneige.com/en/post/linux/setup-your-own-apt-mirror/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://aimerneige.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://aimerneige.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://aimerneige.com/favicon-32x32.png><link rel=apple-touch-icon href=https://aimerneige.com/apple-touch-icon.png><link rel=mask-icon href=https://aimerneige.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://aimerneige.com/en/post/linux/setup-your-own-apt-mirror/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://aimerneige.com/en/post/linux/setup-your-own-apt-mirror/"><meta property="og:site_name" content="Aimer's Blog"><meta property="og:title" content="Setup Your Own Apt Mirror"><meta property="og:description" content="What you need a server running ubuntu enough disk space (at least 600G) good internet connection a domain name (optional) a ssl certificate (optional) Prepare your server You can buy a cloud server, or use a local machine. Here, I am using a local machine to setup a offline apt mirror which can speed up my workflow.
Install apt-mirror Just run the following command to install apt-mirror on your server:"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-12-14T23:08:17+08:00"><meta property="article:modified_time" content="2024-12-14T23:08:17+08:00"><meta property="article:tag" content="Apt"><meta property="article:tag" content="Self-Hosting"><meta name=twitter:card content="summary"><meta name=twitter:title content="Setup Your Own Apt Mirror"><meta name=twitter:description content="What you need a server running ubuntu enough disk space (at least 600G) good internet connection a domain name (optional) a ssl certificate (optional) Prepare your server You can buy a cloud server, or use a local machine. Here, I am using a local machine to setup a offline apt mirror which can speed up my workflow.
Install apt-mirror Just run the following command to install apt-mirror on your server:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts üìù","item":"https://aimerneige.com/en/post/"},{"@type":"ListItem","position":2,"name":"Setup Your Own Apt Mirror","item":"https://aimerneige.com/en/post/linux/setup-your-own-apt-mirror/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Setup Your Own Apt Mirror","name":"Setup Your Own Apt Mirror","description":"What you need a server running ubuntu enough disk space (at least 600G) good internet connection a domain name (optional) a ssl certificate (optional) Prepare your server You can buy a cloud server, or use a local machine. Here, I am using a local machine to setup a offline apt mirror which can speed up my workflow.\nInstall apt-mirror Just run the following command to install apt-mirror on your server:","keywords":["apt","self-hosting"],"articleBody":"What you need a server running ubuntu enough disk space (at least 600G) good internet connection a domain name (optional) a ssl certificate (optional) Prepare your server You can buy a cloud server, or use a local machine. Here, I am using a local machine to setup a offline apt mirror which can speed up my workflow.\nInstall apt-mirror Just run the following command to install apt-mirror on your server:\nsudo apt install apt-mirror Patch apt-mirror (optional) Use this repo to patch your apt-mirror. All you need to do is download this repository and replace your /usr/bin/apt-mirror with this repo‚Äôs binary.\nYou have many ways to do this. You can clone it directly on your server if your server have git. Here, I download the binary and use scp to upload it to my server.\n# run this on your local machine scp ./apt-mirror username@your-host:~ # run this on your server sudo mv /usr/bin/apt-mirror /usr/bin/apt-mirror.origin # backup old file sudo mv ./apt-mirror /usr/bin/ This process is optional. If your sync process works fine, ignore this.\nChoose your mirror source The official source is http://archive.ubuntu.com/ubuntu/. You can use it of course, but it may very slow depend on your server‚Äôs region.\nMy server is on Beijing, the nearest and fastest mirror is http://mirrors.huaweicloud.com/ubuntu/. You can do some speed test and choose the best source for you.\nHere are some mirror source in China:\nhttp://cn.archive.ubuntu.com/ubuntu/ http://mirrors.huaweicloud.com/ubuntu/ http://mirrors.aliyun.com/ubuntu/ http://mirrors.ustc.edu.cn/ubuntu/ http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ http://mirrors.sohu.com/ubuntu/ http://mirrors.163.com/ubuntu/ http://mirrors.cloud.tencent.com/ubuntu/ Prepare your disk Choose a palace to store all the file. You can use the default path which is /var/spool/apt-mirror.\nIf you use a different path, copy /var/spool/apt-mirror to your new path:\nFor example, I want to save all the files under my hhd which is mounted on /mnt/data:\ncp /var/spool/apt-mirror /mnt/data/apt-mirror -r Edit your mirror.list Before start mirroring, edit /etc/apt/mirror.list to specify the file store path and source.\nHere is a simple example if you need to mirror both noble and jammy:\nset base_path /mnt/data/apt-mirror set nthreads 20 set _tilde 0 # For Ubuntu 24.04 deb http://mirrors.huaweicloud.com/ubuntu/ noble main restricted universe multiverse deb http://mirrors.huaweicloud.com/ubuntu/ noble-updates main restricted universe multiverse deb http://mirrors.huaweicloud.com/ubuntu/ noble-backports main restricted universe multiverse deb http://mirrors.huaweicloud.com/ubuntu/ noble-security main restricted universe multiverse # For Ubuntu 22.04 deb http://mirrors.huaweicloud.com/ubuntu/ jammy main restricted universe multiverse deb http://mirrors.huaweicloud.com/ubuntu/ jammy-updates main restricted universe multiverse deb http://mirrors.huaweicloud.com/ubuntu/ jammy-backports main restricted universe multiverse deb http://mirrors.huaweicloud.com/ubuntu/ jammy-security main restricted universe multiverse clean http://mirrors.huaweicloud.com/ubuntu/ noble is the code name for Ubuntu 24.04. If you need other versions, you can refer to\nnoble (24.04) jammy (22.04) focal (20.04) bionic (18.04) xenial (16.04) If you need to mirror both amd64 and i386, change your config file like this:\ndeb-amd64 http://mirrors.huaweicloud.com/ubuntu/ noble main restricted universe multiverse deb-amd64 http://mirrors.huaweicloud.com/ubuntu/ noble-updates main restricted universe multiverse deb-amd64 http://mirrors.huaweicloud.com/ubuntu/ noble-backports main restricted universe multiverse deb-amd64 http://mirrors.huaweicloud.com/ubuntu/ noble-security main restricted universe multiverse deb-i386 http://mirrors.huaweicloud.com/ubuntu/ noble main restricted universe multiverse deb-i386 http://mirrors.huaweicloud.com/ubuntu/ noble-updates main restricted universe multiverse deb-i386 http://mirrors.huaweicloud.com/ubuntu/ noble-backports main restricted universe multiverse deb-i386 http://mirrors.huaweicloud.com/ubuntu/ noble-security main restricted universe multiverse Start mirroring Just run the following command to start mirroring:\nsudo apt-mirror This need a long time to download all files from mirror source depend on your network bandwidth. It may cost up to 6 hours. So I highly recommend you run this under tmux.\nConfigure your web server After apt-mirror did its jobs perfectly, you can checkout the file apt-mirror just downloaded. Then, you need to setup a static web server.\nThere are a lot way to serve a static web server. You can choose your favorite one like caddy or nginx. Here I use nginx as an example:\nserver { listen 80; server_name mirrors.aimersoft.org; location / { return 301 /ubuntu; } location /ubuntu { alias /mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com/ubuntu; autoindex on; } } Change the server_name to your domain and change the alias to your path.\nIf you didn‚Äôt setup a domain, it‚Äôs also ok to use bare ip address.\nThe alias path need to be the father directory of dists and pool.\n- ubuntu/ \u003c-- use this path - dists/ - jammy/ - jammy-backports/ - jammy-security - jammy-updates/ - noble/ - noble-backports/ - noble-security - noble-updates/ - pool/ - main/ - multiverse/ - restricted/ - universe/ You can serve website with nginx‚Äôs autoindex. Also, you can use some other static-web-server to make the website looks better.\nYou can start static-web-server like this:\nstatic-web-server \\ --host 127.0.0.1 \\ --port 8080 \\ --root /mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com/ubuntu \\ --directory-listing true or ghfs like this:\nghfs --listen 8080 --root /mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com/ubuntu or Aiursoft.Static like this:\nstatic --path /mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com/ubuntu -p 8080 --allow-directory-browsing Run these binary under tmux or write a service file like this:\nsudo vim /etc/systemd/system/mirror-web.service [Unit] Description=Apt Mirror Web Server After=network.target Wants=network.target [Service] User=www-data Type=simple Restart=on-failure RestartSec=5s ExecStart=/usr/local/bin/ghfs --listen 8080 --root /mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com WorkingDirectory=/mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com LimitNOFILE=1048576 [Install] WantedBy=multi-user.target Then start service like this:\nsudo systemctl start mirror-web Make it runs automatically after system boot:\nsudo systemctl enable mirror-web Finally configure reverse proxy for nginx:\nserver { listen 80; server_name mirrors.aimersoft.org; location / { proxy_pass http://localhost:8080; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Upgrade $http_upgrade; } } Setup https (optional) If you want to setup https too, here is an example:\nserver { listen 443 ssl http2; server_name mirrors.aimersoft.org; ssl_certificate /etc/nginx/ssl/fullchain.pem; ssl_certificate_key /etc/nginx/ssl/privkey.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_prefer_server_ciphers on; ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM'; add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\" always; add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection \"1; mode=block\"; add_header Referrer-Policy \"no-referrer-when-downgrade\"; location / { return 301 /ubuntu; } location /ubuntu { alias /mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com/ubuntu; autoindex on; } } Setup crontab job Add this line to /etc/crontab to auto mirroring every day with crontab:\n0 3 * * * root /usr/bin/apt-mirror Configure your client For Ubuntu 24.04: Edit this file /etc/apt/sources.list.d/ubuntu.sources, replace URIs with your sever:\nTypes: deb # URIs: http://mirrors.huaweicloud.com/ubuntu/ URIs: http://mirrors.aimersoft.org/ubuntu/ Suites: noble noble-updates noble-backports Components: main restricted universe multiverse Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg Types: deb URIs: http://security.ubuntu.com/ubuntu/ Suites: noble-security Components: main restricted universe multiverse Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg For Ubuntu before 24.04: You need to edit /etc/apt/sources.list. Here is an example for ubuntu 22.04:\ndeb http://mirrors.aimersoft.org/ubuntu/ jammy main restricted universe multiverse deb http://mirrors.aimersoft.org/ubuntu/ jammy-updates main restricted universe multiverse deb http://mirrors.aimersoft.org/ubuntu/ jammy-backports main restricted universe multiverse deb http://mirrors.aimersoft.org/ubuntu/ jammy-security main restricted universe multiverse Links Anduin - Setup a Ubuntu apt mirror server Rey Saeed - How to create an offline APT mirror (Ubuntu focused) Joshua - Setting Up a Local Apt Mirror for PPAs Ask Ubuntu - How to create a local repository using apt-mirror and mirrorkit? Ask Ubuntu - How can I prevent apt-mirror from downloading ALL packages Ask Ubuntu - Can a PPA be added to an Ubuntu repo mirror? ËÖæËÆØÈïúÂÉèÊ∫ê - Ubuntu Ê∫êÂ∏ÆÂä©ÊñáÊ°£ ","wordCount":"1090","inLanguage":"en","datePublished":"2024-12-14T23:08:17+08:00","dateModified":"2024-12-14T23:08:17+08:00","author":{"@type":"Person","name":"Aimer Neige"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://aimerneige.com/en/post/linux/setup-your-own-apt-mirror/"},"publisher":{"@type":"Organization","name":"Aimer's Blog","logo":{"@type":"ImageObject","url":"https://aimerneige.com/favicon.ico"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://aimerneige.com/en/ accesskey=h title="Aimer's Blog (Alt + H)">Aimer's Blog</a><div class=logo-switches><ul class=lang-switch><li>|</li><li><a href=https://aimerneige.com/zh/ title=‰∏≠Êñá aria-label=‰∏≠Êñá>‰∏≠Êñá</a></li></ul></div></div><ul id=menu><li><a href=https://aimerneige.com/en/about/ title=About><span>About</span></a></li><li><a href=https://aimerneige.com/en/post/ title=Post><span>Post</span></a></li><li><a href=https://aimerneige.com/en/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://aimerneige.com/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://aimerneige.com/en/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://aimerneige.com/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://aimerneige.com/en/>Home</a>&nbsp;¬ª&nbsp;<a href=https://aimerneige.com/en/post/>Posts üìù</a></div><h1 class="post-title entry-hint-parent">Setup Your Own Apt Mirror</h1><div class=post-meta><span title='2024-12-14 23:08:17 +0800 +0800'>December 14, 2024</span>&nbsp;¬∑&nbsp;Aimer Neige&nbsp;|&nbsp;<a href=https://github.com/aimerneige/blog/edit/master/content/post/Linux/setup-your-own-apt-mirror.en.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#what-you-need aria-label="What you need">What you need</a></li><li><a href=#prepare-your-server aria-label="Prepare your server">Prepare your server</a></li><li><a href=#install-apt-mirror aria-label="Install apt-mirror">Install apt-mirror</a></li><li><a href=#patch-apt-mirror-optional aria-label="Patch apt-mirror (optional)">Patch apt-mirror (optional)</a></li><li><a href=#choose-your-mirror-source aria-label="Choose your mirror source">Choose your mirror source</a></li><li><a href=#prepare-your-disk aria-label="Prepare your disk">Prepare your disk</a></li><li><a href=#edit-your-mirrorlist aria-label="Edit your mirror.list">Edit your mirror.list</a></li><li><a href=#start-mirroring aria-label="Start mirroring">Start mirroring</a></li><li><a href=#configure-your-web-server aria-label="Configure your web server">Configure your web server</a></li><li><a href=#setup-https-optional aria-label="Setup https (optional)">Setup https (optional)</a></li><li><a href=#setup-crontab-job aria-label="Setup crontab job">Setup crontab job</a></li><li><a href=#configure-your-client aria-label="Configure your client">Configure your client</a><ul><li><a href=#for-ubuntu-2404 aria-label="For Ubuntu 24.04:">For Ubuntu 24.04:</a></li><li><a href=#for-ubuntu-before-2404 aria-label="For Ubuntu before 24.04:">For Ubuntu before 24.04:</a></li></ul></li><li><a href=#links aria-label=Links>Links</a></li></ul></div></details></div><div class=post-content><h2 id=what-you-need>What you need<a hidden class=anchor aria-hidden=true href=#what-you-need>#</a></h2><ol><li>a server running ubuntu</li><li>enough disk space (at least 600G)</li><li>good internet connection</li><li>a domain name (optional)</li><li>a ssl certificate (optional)</li></ol><h2 id=prepare-your-server>Prepare your server<a hidden class=anchor aria-hidden=true href=#prepare-your-server>#</a></h2><p>You can buy a cloud server, or use a local machine. Here, I am using a local machine to setup a offline apt mirror which can speed up my workflow.</p><h2 id=install-apt-mirror>Install <code>apt-mirror</code><a hidden class=anchor aria-hidden=true href=#install-apt-mirror>#</a></h2><p>Just run the following command to install apt-mirror on your server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install apt-mirror
</span></span></code></pre></div><h2 id=patch-apt-mirror-optional>Patch apt-mirror (optional)<a hidden class=anchor aria-hidden=true href=#patch-apt-mirror-optional>#</a></h2><p>Use this <a href=https://github.com/apt-mirror/apt-mirror>repo</a> to patch your apt-mirror. All you need to do is download this repository and replace your <code>/usr/bin/apt-mirror</code> with this repo&rsquo;s binary.</p><p>You have many ways to do this. You can clone it directly on your server if your server have git. Here, I download the binary and use scp to upload it to my server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># run this on your local machine</span>
</span></span><span style=display:flex><span>scp ./apt-mirror username@your-host:~
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># run this on your server</span>
</span></span><span style=display:flex><span>sudo mv /usr/bin/apt-mirror /usr/bin/apt-mirror.origin <span style=color:#75715e># backup old file</span>
</span></span><span style=display:flex><span>sudo mv ./apt-mirror /usr/bin/
</span></span></code></pre></div><p>This process is optional. If your sync process works fine, ignore this.</p><h2 id=choose-your-mirror-source>Choose your mirror source<a hidden class=anchor aria-hidden=true href=#choose-your-mirror-source>#</a></h2><p>The official source is <code>http://archive.ubuntu.com/ubuntu/</code>. You can use it of course, but it may very slow depend on your server&rsquo;s region.</p><p>My server is on Beijing, the nearest and fastest mirror is <code>http://mirrors.huaweicloud.com/ubuntu/</code>. You can do some speed test and choose the best source for you.</p><p>Here are some mirror source in China:</p><ul><li><a href=http://cn.archive.ubuntu.com/ubuntu/>http://cn.archive.ubuntu.com/ubuntu/</a></li><li><a href=http://mirrors.huaweicloud.com/ubuntu/>http://mirrors.huaweicloud.com/ubuntu/</a></li><li><a href=http://mirrors.aliyun.com/ubuntu/>http://mirrors.aliyun.com/ubuntu/</a></li><li><a href=http://mirrors.ustc.edu.cn/ubuntu/>http://mirrors.ustc.edu.cn/ubuntu/</a></li><li><a href=http://mirrors.tuna.tsinghua.edu.cn/ubuntu/>http://mirrors.tuna.tsinghua.edu.cn/ubuntu/</a></li><li><a href=http://mirrors.sohu.com/ubuntu/>http://mirrors.sohu.com/ubuntu/</a></li><li><a href=http://mirrors.163.com/ubuntu/>http://mirrors.163.com/ubuntu/</a></li><li><a href=http://mirrors.cloud.tencent.com/ubuntu/>http://mirrors.cloud.tencent.com/ubuntu/</a></li></ul><h2 id=prepare-your-disk>Prepare your disk<a hidden class=anchor aria-hidden=true href=#prepare-your-disk>#</a></h2><p>Choose a palace to store all the file. You can use the default path which is <code>/var/spool/apt-mirror</code>.</p><p>If you use a different path, copy <code>/var/spool/apt-mirror</code> to your new path:</p><p>For example, I want to save all the files under my hhd which is mounted on <code>/mnt/data</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp /var/spool/apt-mirror /mnt/data/apt-mirror -r
</span></span></code></pre></div><h2 id=edit-your-mirrorlist>Edit your <code>mirror.list</code><a hidden class=anchor aria-hidden=true href=#edit-your-mirrorlist>#</a></h2><p>Before start mirroring, edit <code>/etc/apt/mirror.list</code> to specify the file store path and source.</p><p>Here is a simple example if you need to mirror both noble and jammy:</p><pre tabindex=0><code>set base_path    /mnt/data/apt-mirror
set nthreads     20
set _tilde 0

# For Ubuntu 24.04
deb http://mirrors.huaweicloud.com/ubuntu/ noble main restricted universe multiverse
deb http://mirrors.huaweicloud.com/ubuntu/ noble-updates main restricted universe multiverse
deb http://mirrors.huaweicloud.com/ubuntu/ noble-backports main restricted universe multiverse
deb http://mirrors.huaweicloud.com/ubuntu/ noble-security main restricted universe multiverse

# For Ubuntu 22.04
deb http://mirrors.huaweicloud.com/ubuntu/ jammy main restricted universe multiverse
deb http://mirrors.huaweicloud.com/ubuntu/ jammy-updates main restricted universe multiverse
deb http://mirrors.huaweicloud.com/ubuntu/ jammy-backports main restricted universe multiverse
deb http://mirrors.huaweicloud.com/ubuntu/ jammy-security main restricted universe multiverse

clean http://mirrors.huaweicloud.com/ubuntu/
</code></pre><p><code>noble</code> is the code name for Ubuntu 24.04. If you need other versions, you can refer to</p><ul><li>noble (24.04)</li><li>jammy (22.04)</li><li>focal (20.04)</li><li>bionic (18.04)</li><li>xenial (16.04)</li></ul><p>If you need to mirror both amd64 and i386, change your config file like this:</p><pre tabindex=0><code>deb-amd64 http://mirrors.huaweicloud.com/ubuntu/ noble main restricted universe multiverse
deb-amd64 http://mirrors.huaweicloud.com/ubuntu/ noble-updates main restricted universe multiverse
deb-amd64 http://mirrors.huaweicloud.com/ubuntu/ noble-backports main restricted universe multiverse
deb-amd64 http://mirrors.huaweicloud.com/ubuntu/ noble-security main restricted universe multiverse

deb-i386 http://mirrors.huaweicloud.com/ubuntu/ noble main restricted universe multiverse
deb-i386 http://mirrors.huaweicloud.com/ubuntu/ noble-updates main restricted universe multiverse
deb-i386 http://mirrors.huaweicloud.com/ubuntu/ noble-backports main restricted universe multiverse
deb-i386 http://mirrors.huaweicloud.com/ubuntu/ noble-security main restricted universe multiverse
</code></pre><h2 id=start-mirroring>Start mirroring<a hidden class=anchor aria-hidden=true href=#start-mirroring>#</a></h2><p>Just run the following command to start mirroring:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-mirror
</span></span></code></pre></div><p>This need a long time to download all files from mirror source depend on your network bandwidth. It may cost up to 6 hours. So I highly recommend you run this under tmux.</p><h2 id=configure-your-web-server>Configure your web server<a hidden class=anchor aria-hidden=true href=#configure-your-web-server>#</a></h2><p>After apt-mirror did its jobs perfectly, you can checkout the file apt-mirror just downloaded. Then, you need to setup a static web server.</p><p>There are a lot way to serve a static web server. You can choose your favorite one like caddy or nginx. Here I use nginx as an example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>mirrors.aimersoft.org</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>/ubuntu</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/ubuntu</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>alias</span> <span style=color:#e6db74>/mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com/ubuntu</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>autoindex</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Change the server_name to your domain and change the alias to your path.</p><p>If you didn&rsquo;t setup a domain, it&rsquo;s also ok to use bare ip address.</p><p>The alias path need to be the father directory of <code>dists</code> and <code>pool</code>.</p><pre tabindex=0><code>- ubuntu/ &lt;-- use this path
    - dists/
        - jammy/
        - jammy-backports/
        - jammy-security
        - jammy-updates/
        - noble/
        - noble-backports/
        - noble-security
        - noble-updates/
    - pool/
        - main/
        - multiverse/
        - restricted/
        - universe/
</code></pre><p>You can serve website with nginx&rsquo;s autoindex. Also, you can use some other static-web-server to make the website looks better.</p><p>You can start <a href=https://github.com/static-web-server/static-web-server>static-web-server</a> like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>static-web-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --host 127.0.0.1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --port <span style=color:#ae81ff>8080</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --root /mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com/ubuntu <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --directory-listing true
</span></span></code></pre></div><p>or <a href=https://github.com/mjpclab/go-http-file-server>ghfs</a> like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ghfs --listen <span style=color:#ae81ff>8080</span> --root /mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com/ubuntu
</span></span></code></pre></div><p>or <a href=https://github.com/AiursoftWeb/Static>Aiursoft.Static</a> like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>static --path /mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com/ubuntu -p <span style=color:#ae81ff>8080</span> --allow-directory-browsing
</span></span></code></pre></div><p>Run these binary under tmux or write a service file like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/systemd/system/mirror-web.service
</span></span></code></pre></div><pre tabindex=0><code>[Unit]
Description=Apt Mirror Web Server
After=network.target
Wants=network.target

[Service]
User=www-data
Type=simple
Restart=on-failure
RestartSec=5s
ExecStart=/usr/local/bin/ghfs --listen 8080 --root /mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com
WorkingDirectory=/mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com
LimitNOFILE=1048576

[Install]
WantedBy=multi-user.target
</code></pre><p>Then start service like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl start mirror-web
</span></span></code></pre></div><p>Make it runs automatically after system boot:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl enable mirror-web
</span></span></code></pre></div><p>Finally configure reverse proxy for nginx:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>mirrors.aimersoft.org</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://localhost:8080</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-Proto</span> $scheme;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=setup-https-optional>Setup https (optional)<a hidden class=anchor aria-hidden=true href=#setup-https-optional>#</a></h2><p>If you want to setup https too, here is an example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span> <span style=color:#e6db74>http2</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>mirrors.aimersoft.org</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>/etc/nginx/ssl/fullchain.pem</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>/etc/nginx/ssl/privkey.pem</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_protocols</span> <span style=color:#e6db74>TLSv1.2</span> <span style=color:#e6db74>TLSv1.3</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_prefer_server_ciphers</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span> <span style=color:#e6db74>&#39;EECDH+AESGCM:EDH+AESGCM&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Strict-Transport-Security</span> <span style=color:#e6db74>&#34;max-age=31536000</span>; <span style=color:#f92672>includeSubDomains</span>; <span style=color:#f92672>preload&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-Frame-Options</span> <span style=color:#e6db74>DENY</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-Content-Type-Options</span> <span style=color:#e6db74>nosniff</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-XSS-Protection</span> <span style=color:#e6db74>&#34;1</span>; <span style=color:#f92672>mode=block&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Referrer-Policy</span> <span style=color:#e6db74>&#34;no-referrer-when-downgrade&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>/ubuntu</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/ubuntu</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>alias</span> <span style=color:#e6db74>/mnt/data/apt-mirror/mirror/mirrors.huaweicloud.com/ubuntu</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>autoindex</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=setup-crontab-job>Setup crontab job<a hidden class=anchor aria-hidden=true href=#setup-crontab-job>#</a></h2><p>Add this line to <code>/etc/crontab</code> to auto mirroring every day with crontab:</p><pre tabindex=0><code>0  3  * * *     root    /usr/bin/apt-mirror
</code></pre><h2 id=configure-your-client>Configure your client<a hidden class=anchor aria-hidden=true href=#configure-your-client>#</a></h2><h3 id=for-ubuntu-2404>For Ubuntu 24.04:<a hidden class=anchor aria-hidden=true href=#for-ubuntu-2404>#</a></h3><p>Edit this file <code>/etc/apt/sources.list.d/ubuntu.sources</code>, replace <code>URIs</code> with your sever:</p><pre tabindex=0><code>Types: deb
# URIs: http://mirrors.huaweicloud.com/ubuntu/
URIs: http://mirrors.aimersoft.org/ubuntu/
Suites: noble noble-updates noble-backports
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

Types: deb
URIs: http://security.ubuntu.com/ubuntu/
Suites: noble-security
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg
</code></pre><h3 id=for-ubuntu-before-2404>For Ubuntu before 24.04:<a hidden class=anchor aria-hidden=true href=#for-ubuntu-before-2404>#</a></h3><p>You need to edit <code>/etc/apt/sources.list</code>. Here is an example for ubuntu 22.04:</p><pre tabindex=0><code>deb http://mirrors.aimersoft.org/ubuntu/ jammy main restricted universe multiverse
deb http://mirrors.aimersoft.org/ubuntu/ jammy-updates main restricted universe multiverse
deb http://mirrors.aimersoft.org/ubuntu/ jammy-backports main restricted universe multiverse
deb http://mirrors.aimersoft.org/ubuntu/ jammy-security main restricted universe multiverse
</code></pre><h2 id=links>Links<a hidden class=anchor aria-hidden=true href=#links>#</a></h2><ul><li><a href=https://anduin.aiursoft.cn/post/2024/2/8/setup-a-ubuntu-apt-mirror-server>Anduin - Setup a Ubuntu apt mirror server</a></li><li><a href=https://medium.com/@rsaeedbiz/how-to-create-an-offline-apt-mirror-ubuntu-focused-980e5d022337>Rey Saeed - How to create an offline APT mirror (Ubuntu focused)</a></li><li><a href=https://blog.lupecode.com/setting-up-a-local-apt-mirror-for-ppas/>Joshua - Setting Up a Local Apt Mirror for PPAs</a></li><li><a href=https://askubuntu.com/questions/551064/how-to-create-a-local-repository-using-apt-mirror-and-mirrorkit>Ask Ubuntu - How to create a local repository using apt-mirror and mirrorkit?</a></li><li><a href=https://askubuntu.com/questions/1033669/how-can-i-prevent-apt-mirror-from-downloading-all-packages>Ask Ubuntu - How can I prevent apt-mirror from downloading ALL packages</a></li><li><a href=https://askubuntu.com/questions/28124/can-a-ppa-be-added-to-an-ubuntu-repo-mirror>Ask Ubuntu - Can a PPA be added to an Ubuntu repo mirror?</a></li><li><a href=https://mirrors.tencent.com/help/ubuntu.html>ËÖæËÆØÈïúÂÉèÊ∫ê - Ubuntu Ê∫êÂ∏ÆÂä©ÊñáÊ°£</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://aimerneige.com/en/tags/apt/>Apt</a></li><li><a href=https://aimerneige.com/en/tags/self-hosting/>Self-Hosting</a></li></ul><nav class=paginav><a class=prev href=https://aimerneige.com/en/post/linux/fix-linux-efi/><span class=title>¬´ Prev</span><br><span>Fix Linux EFI</span>
</a><a class=next href=https://aimerneige.com/en/post/minecraft/how-to-setup-your-fabric-workspace/><span class=title>Next ¬ª</span><br><span>How to Setup Your Fabric Workspace</span></a></nav></footer><div id=license><p>This article is licensed under
<a target=_blank rel=noopener href=http://creativecommons.org/licenses/by-nc/4.0/ style=color:#00b5da><u>CC-BY-NC-4.0</u></a></p></div><div id=comment><script id=utterances src=https://utteranc.es/client.js repo=aimerneige/aimerneige.github.io issue-term=title label=comment theme=preferred-color-scheme crossorigin=anonymous async></script><script>let ua=navigator.userAgent.toLocaleLowerCase();ua.match(/QQ/i)=="qq"&&document.getElementById("utterances").remove(),ua.match(/MicroMessenger/i)=="micromessenger"&&document.getElementById("utterances").remove()</script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://aimerneige.com/en/>Aimer's Blog</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>